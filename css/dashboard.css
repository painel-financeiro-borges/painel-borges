<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel Central Borges</title>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <!-- Fonte -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- SortableJS -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

  <link rel="stylesheet" href="dashboard.css">
</head>

<body>

<header>
  <h1>ğŸ§  Painel Central Borges</h1>

  <div id="auth-area">
    <button id="loginBtn" onclick="loginGoogle()">Entrar com Google</button>
    <button id="logoutBtn" onclick="logout()" style="display:none;">Sair</button>
  </div>
</header>

<main id="app" style="display:none;">

  <!-- DASHBOARD -->
  <section class="cards">
    <div class="card" onclick="location.href='life.html'">
      <span>ğŸ§ </span><div class="card-title">Vida</div>
    </div>

    <div class="card" onclick="location.href='index.html'">
      <span>ğŸ’°</span><div class="card-title">Financeiro</div>
    </div>

    <div class="card" onclick="abrirChecklists()">
      <span>âœ…</span><div class="card-title">Checklists</div>
    </div>
  </section>

  <!-- CHECKLIST KANBAN -->
  <section id="checklists-section" style="display:none;">

    <h2>âœ… Checklist Organizado</h2>

    <div class="kanban">

      <div class="column">
        <h3>ğŸ”´ Urgente</h3>
        <div class="list" data-priority="high"></div>
      </div>

      <div class="column">
        <h3>ğŸŸ¡ MÃ©dio</h3>
        <div class="list" data-priority="medium"></div>
      </div>

      <div class="column">
        <h3>ğŸŸ¢ Baixo</h3>
        <div class="list" data-priority="low"></div>
      </div>

      <div class="column">
        <h3>âšª Sem prioridade</h3>
        <div class="list" data-priority="none"></div>
      </div>

    </div>

    <div class="novo-item">
      <input id="novo-item-texto" placeholder="Novo item">
      <select id="novo-item-prioridade">
        <option value="none">Sem prioridade</option>
        <option value="high">Urgente</option>
        <option value="medium">MÃ©dio</option>
        <option value="low">Baixo</option>
      </select>
      <button onclick="criarItem()">Adicionar</button>
    </div>

  </section>

</main>

<script>
  // Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBnOexg7KChfV2OsKBCDCuMCRT2xcAwKx8",
    authDomain: "painel-financeiro-borges.firebaseapp.com",
    projectId: "painel-financeiro-borges",
    storageBucket: "painel-financeiro-borges.firebasestorage.app",
    messagingSenderId: "354997627208",
    appId: "1:354997627208:web:90604d0a7dcd45b6e4eb7d"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();
  let uid = null;

  auth.onAuthStateChanged(user => {
    if (user) {
      uid = user.uid;
      loginBtn.style.display = "none";
      logoutBtn.style.display = "inline-block";
      app.style.display = "block";
      carregarItens();
      ativarDrag();
    }
  });

  function loginGoogle() {
    auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
  }

  function logout() {
    auth.signOut();
  }

  function abrirChecklists() {
    document.querySelector(".cards").style.display = "none";
    document.getElementById("checklists-section").style.display = "block";
  }

  function criarItem() {
    const texto = novoItemTexto.value;
    const prioridade = novoItemPrioridade.value;
    if (!texto) return;

    db.collection("users").doc(uid)
      .collection("checklist")
      .add({
        text: texto,
        priority: prioridade,
        position: Date.now(),
        deleted: false
      })
      .then(() => {
        novoItemTexto.value = "";
        carregarItens();
      });
  }

  function carregarItens() {
    document.querySelectorAll(".list").forEach(l => l.innerHTML = "");

    db.collection("users").doc(uid)
      .collection("checklist")
      .where("deleted", "==", false)
      .get()
      .then(snapshot => {
        snapshot.forEach(doc => {
          const item = doc.data();
          const div = document.createElement("div");
          div.className = "item";
          div.dataset.id = doc.id;
          div.innerHTML = `
            <input value="${item.text}" onchange="editarItem('${doc.id}', this.value)">
            <button onclick="excluirItem('${doc.id}')">ğŸ—‘ï¸</button>
          `;
          document.querySelector(`.list[data-priority="${item.priority}"]`)
            .appendChild(div);
        });
      });
  }

  function editarItem(id, texto) {
    db.collection("users").doc(uid).collection("checklist")
      .doc(id).update({ text: texto });
  }

  function excluirItem(id) {
    db.collection("users").doc(uid).collection("checklist")
      .doc(id).update({ deleted: true }).then(carregarItens);
  }

  function ativarDrag() {
    document.querySelectorAll(".list").forEach(list => {
      new Sortable(list, {
        group: "kanban",
        animation: 150,
        onAdd: evt => {
          const id = evt.item.dataset.id;
          const novaPrioridade = evt.to.dataset.priority;
          db.collection("users").doc(uid)
            .collection("checklist")
            .doc(id).update({ priority: novaPrioridade });
        }
      });
    });
  }
</script>

</body>
</html>
