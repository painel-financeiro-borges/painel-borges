<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema Inteligente de Reserva</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  padding: 20px;
}
textarea, input, select, button {
  width: 100%;
  margin: 6px 0;
  padding: 10px;
  border-radius: 6px;
  border: none;
}
textarea { height: 220px; font-family: monospace; }
button {
  background: #2563eb;
  color: white;
  font-weight: bold;
  cursor: pointer;
}
.card {
  background: #020617;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 15px;
}
.log {
  background: #020617;
  padding: 10px;
  border-left: 4px solid #2563eb;
  margin-top: 10px;
}
.block { border-left-color: #dc2626; }
.ok { border-left-color: #16a34a; }
.warn { border-left-color: #facc15; }
</style>
</head>
<body>

<h2>üõ°Ô∏è Sistema de Reserva por Regras</h2>

<div class="card">
<h3>üì• JSON das Regras</h3>
<textarea id="jsonInput" placeholder="Cole aqui o JSON da reserva"></textarea>
<button onclick="loadJSON()">Carregar Sistema</button>
</div>

<div class="card">
<h3>üí∞ Simulador de Saque</h3>
<input type="number" id="valor" placeholder="Valor do saque">
<select id="categoria"></select>
<button onclick="simularSaque()">Simular Saque</button>
</div>

<div id="resultado"></div>

<script>
let sistema = null;

function loadJSON() {
  try {
    sistema = JSON.parse(document.getElementById("jsonInput").value);
    const select = document.getElementById("categoria");
    select.innerHTML = "";
    sistema.usage_categories.forEach(c => {
      const opt = document.createElement("option");
      opt.value = c.id;
      opt.textContent = c.name;
      select.appendChild(opt);
    });
    alert("Sistema carregado com sucesso.");
  } catch {
    alert("JSON inv√°lido.");
  }
}

function simularSaque() {
  if (!sistema) return alert("Carregue o sistema primeiro.");

  const valor = Number(document.getElementById("valor").value);
  const catId = document.getElementById("categoria").value;
  const reserva = sistema.main_reserve;
  const categoria = sistema.usage_categories.find(c => c.id === catId);

  let msg = "";
  let status = "ok";

  if (!categoria.allowed) {
    msg = "Saque BLOQUEADO. Categoria n√£o permitida.";
    status = "block";
  } else if ((reserva.balance - valor) < reserva.meta.minimum_safe) {
    msg = "Saque NEGADO. Violaria o m√≠nimo de seguran√ßa.";
    status = "block";
  } else {
    msg = "Saque APROVADO dentro das regras.";
  }

  document.getElementById("resultado").innerHTML = `
    <div class="log ${status}">
      <strong>Resultado:</strong><br>
      ${msg}<br><br>
      <small>Reserva atual: R$ ${reserva.balance.toFixed(2)}</small>
    </div>
  `;
}
</script>

</body>
</html>
